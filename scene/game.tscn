[gd_scene load_steps=27 format=3 uid="uid://c8kgiptw27hnk"]

[ext_resource type="PackedScene" uid="uid://cdmckyq563mja" path="res://scene/players/player.tscn" id="1_5kiuu"]
[ext_resource type="AudioStream" uid="uid://b4so8tomtpylw" path="res://audio/footsteps.wav" id="1_jhlss"]
[ext_resource type="Script" uid="uid://bs2oplm10hnhp" path="res://script/manager/StaircaseLevelManager.gd" id="1_p1ry8"]
[ext_resource type="AudioStream" uid="uid://caoec1xnfl4aq" path="res://audio/air_vent.wav" id="1_ux4dc"]
[ext_resource type="Script" uid="uid://dcl5uq8phjyx3" path="res://script/manager/GameManager.gd" id="1_ww6yf"]
[ext_resource type="PackedScene" uid="uid://csb6mtlftuisj" path="res://scene/water_dripping.tscn" id="2_jrd6n"]
[ext_resource type="Texture2D" uid="uid://d2ypp8xig7ohc" path="res://sprite/center_column_occluder.png" id="3_i6gbm"]
[ext_resource type="Texture2D" uid="uid://so5sxf56le20" path="res://sprite/room_occluder.png" id="4_ux4dc"]
[ext_resource type="Shader" uid="uid://cxfc8j0uk4w5d" path="res://shader/Xray.gdshader" id="8_0lu6w"]
[ext_resource type="Texture2D" uid="uid://bjr0vl3awhamp" path="res://sprite/room.png" id="8_17rxn"]
[ext_resource type="Texture2D" uid="uid://bwiif3lm1mh17" path="res://sprite/spiral_staircase.png" id="8_yq8tf"]
[ext_resource type="Texture2D" uid="uid://cfrlwfaum460c" path="res://sprite/center_column.png" id="9_yq8tf"]
[ext_resource type="Theme" uid="uid://i8eh517uqjrl" path="res://scary_theme.tres" id="14_0lu6w"]
[ext_resource type="Script" uid="uid://cj4soutrhar4o" path="res://script/HUD/ActionCostHUD.gd" id="14_jrd6n"]
[ext_resource type="PackedScene" uid="uid://d0o7x3il6yic5" path="res://scene/HUD/hunger_hud.tscn" id="14_ve786"]
[ext_resource type="PackedScene" uid="uid://dyu1r4m2jya2a" path="res://scene/HUD/desperation_hud.tscn" id="15_0lu6w"]
[ext_resource type="Script" uid="uid://cyvnca1t0msnu" path="res://script/HUD/FloorCounterHUD.gd" id="15_i6gbm"]
[ext_resource type="PackedScene" uid="uid://bra1gh301wal2" path="res://scene/players/xray_player.tscn" id="17_i6gbm"]
[ext_resource type="Script" uid="uid://bmyy6bkrou0l5" path="res://script/Subviewport.gd" id="17_ux4dc"]

[sub_resource type="OccluderPolygon2D" id="OccluderPolygon2D_jrd6n"]
polygon = PackedVector2Array(5, 48, 5, 54, 15, 54, 15, 48)

[sub_resource type="CapsuleShape2D" id="CapsuleShape2D_5g16k"]
radius = 33.0
height = 72.0

[sub_resource type="NavigationPolygon" id="NavigationPolygon_ve786"]
vertices = PackedVector2Array(-90.6563, -40.7969, -64, -47.9609, -64, -44.3125, -81.5938, -38.7109, -95.1406, -23.8125, -118, -21.3984, -100.211, -2.28906, -129.594, 4.24219, -124.742, 30.1172, -96.2969, 19.8438, -102.391, 52.4609, -74.4766, 41.6563, -72.6172, 64.1797, -56.5, 65.8828, -44.6875, 44.1406, -17.3906, 57.7031, -22.9063, 36.4531, 10.1016, 35.5234, 20.1563, 16.3281, -5.17969, 13.6563, 26.5625, -8, 64.2422, -1, 98, -1, 115, 1, 115, 22.8203, 74.1172, 22.1016, 62.5391, -0.09375, 98, -18, 116, -18, 116, 1, 48.1328, -3.47656, 31.5313, -4.99219, 41.7969, -8, -21.8672, -36.5469, -39.7734, -42.2422, -39.2891, -58, -23.4375, -58, 3.04688, -44.3203, -3.82813, -12.0469)
polygons = Array[PackedInt32Array]([PackedInt32Array(0, 1, 2, 3), PackedInt32Array(0, 3, 4, 5), PackedInt32Array(5, 4, 6, 7), PackedInt32Array(8, 7, 6, 9, 10), PackedInt32Array(10, 9, 11, 12), PackedInt32Array(13, 12, 11, 14, 15), PackedInt32Array(15, 14, 16, 17), PackedInt32Array(18, 17, 16, 19, 20), PackedInt32Array(21, 22, 23, 24, 25, 26), PackedInt32Array(22, 27, 28, 29, 23), PackedInt32Array(30, 21, 26, 31), PackedInt32Array(32, 30, 31, 20), PackedInt32Array(33, 34, 35, 36, 37), PackedInt32Array(38, 33, 37, 20), PackedInt32Array(19, 38, 20), PackedInt32Array(18, 20, 31)])
outlines = Array[PackedVector2Array]([PackedVector2Array(-49, -68, -50, -35, -28, -28, -14, -9, -15, 10, -29, 28, -46, 34, -70, 32, -87, 15, -90, -2, -86, -19, -76, -30, -54, -37, -54, -61, -95, -50, -126, -28, -140, 3, -134, 35, -108, 61, -75, 74, -56, 76, -13, 67, 18, 42, 29, 21, 37, 6, 56, 9, 68, 32, 125, 33, 125, 11, 155, 11, 155, -5, 126, -5, 126, -28, 88, -28, 88, -11, 65, -11, 52, -13, 45, -18, 32, -18, 10, -52, -21, -68)])

[sub_resource type="OccluderPolygon2D" id="OccluderPolygon2D_ve786"]
polygon = PackedVector2Array(-34, -90, -33, -9, -27, 9, -4, 21, 18, 12, 28, -2, 31, -90)

[sub_resource type="OccluderPolygon2D" id="OccluderPolygon2D_0lu6w"]
polygon = PackedVector2Array(-52, -60, -53, -14, -47, -14, -46, -55, 65, -56, 65, 31, -49, 31, -49, 12, -54, 12, -53, 36, 70, 36, 70, -60)

[sub_resource type="ViewportTexture" id="ViewportTexture_i6gbm"]
viewport_path = NodePath("SubViewport")

[sub_resource type="ShaderMaterial" id="ShaderMaterial_i6gbm"]
resource_local_to_scene = true
shader = ExtResource("8_0lu6w")
shader_parameter/player_viewport = SubResource("ViewportTexture_i6gbm")
shader_parameter/tint = Color(0.866328, 0.957632, 0.988133, 1)

[node name="game" type="Node2D" node_paths=PackedStringArray("player")]
process_mode = 1
script = ExtResource("1_ww6yf")
player = NodePath("player")

[node name="Constant" type="Node2D" parent="."]

[node name="ambient_footsteps" type="AudioStreamPlayer2D" parent="Constant"]
position = Vector2(0, -137)
stream = ExtResource("1_jhlss")
max_distance = 300.0
attenuation = 1.6245
bus = &"Ambience"

[node name="air_vent_sound" type="AudioStreamPlayer" parent="Constant"]
stream = ExtResource("1_ux4dc")
volume_db = -5.0
pitch_scale = 0.7
autoplay = true
bus = &"Ambience"

[node name="water_dripping" parent="Constant" instance=ExtResource("2_jrd6n")]
z_index = 200
position = Vector2(-116, -86)

[node name="LightOccluder2D" type="LightOccluder2D" parent="Constant/water_dripping"]
position = Vector2(-9, 6)
occluder = SubResource("OccluderPolygon2D_jrd6n")

[node name="DirectionalLight2D" type="DirectionalLight2D" parent="Constant"]
color = Color(1, 0.765902, 0.727379, 1)
energy = 0.31
blend_mode = 1

[node name="origin" type="RigidBody2D" parent="Constant"]
z_index = 100
position = Vector2(-52, 0)
gravity_scale = 0.0
lock_rotation = true
freeze = true

[node name="CollisionShape2D" type="CollisionShape2D" parent="Constant/origin"]
rotation = 1.5708
shape = SubResource("CapsuleShape2D_5g16k")

[node name="staircase_top_marker" type="Marker2D" parent="Constant"]
position = Vector2(-41, -59)

[node name="evil_spawn_location" type="Marker2D" parent="Constant"]
position = Vector2(-76.527, -45.311)

[node name="background_collision" type="StaticBody2D" parent="Constant"]
visible = false
z_index = 100
collision_mask = 0

[node name="CollisionPolygon2D" type="CollisionPolygon2D" parent="Constant/background_collision"]
polygon = PackedVector2Array(-15, -86, -15, -68, 11, -53, 30, -25, 31, -23, 39, -18, 44, -18, 44, -28, 156, -28, 156, 48, 42, 49, 42, 14, 37, 14, 32, 19, 26, 34, 8, 54, -13, 68, -49, 76, -61, 77, -83, 73, -114, 59, -137, 35, -143, -1, -124, -32, -94, -52, -79, -72, -52, -78, -16, -68, -16, -86, -157, -85, -157, 93, 163, 94, 163, -86)

[node name="NavigationRegion2D" type="NavigationRegion2D" parent="Constant"]
visible = false
navigation_polygon = SubResource("NavigationPolygon_ve786")

[node name="spiral_staircase" type="Sprite2D" parent="Constant"]
position = Vector2(-55, 11)
texture = ExtResource("8_yq8tf")
metadata/_edit_lock_ = true

[node name="centre_column" type="Sprite2D" parent="Constant"]
position = Vector2(-55, 11)
texture = ExtResource("9_yq8tf")
metadata/_edit_lock_ = true

[node name="LightOccluder2D" type="LightOccluder2D" parent="Constant/centre_column"]
occluder = SubResource("OccluderPolygon2D_ve786")

[node name="room" type="Sprite2D" parent="Constant"]
position = Vector2(91, 2)
texture = ExtResource("8_17rxn")
metadata/_edit_lock_ = true

[node name="LightOccluder2D" type="LightOccluder2D" parent="Constant/room"]
occluder = SubResource("OccluderPolygon2D_0lu6w")

[node name="foreground" type="Node2D" parent="Constant"]
z_index = 200

[node name="center_column_occluder" type="Sprite2D" parent="Constant/foreground"]
material = SubResource("ShaderMaterial_i6gbm")
position = Vector2(-55, 11)
texture = ExtResource("3_i6gbm")

[node name="front_wall_occluder" type="Sprite2D" parent="Constant/foreground"]
position = Vector2(91, 2)
texture = ExtResource("4_ux4dc")

[node name="Levels" type="Node2D" parent="."]

[node name="player" parent="." node_paths=PackedStringArray("origin_node") instance=ExtResource("1_5kiuu")]
z_index = 30
position = Vector2(-53, -60)
origin_node = NodePath("../Constant/origin")

[node name="Camera2D" type="Camera2D" parent="."]

[node name="staircase_level_manager" type="Node" parent="." node_paths=PackedStringArray("player", "ambient_footstep_sfx_player")]
script = ExtResource("1_p1ry8")
player = NodePath("../player")
ambient_footstep_sfx_player = NodePath("../Constant/ambient_footsteps")

[node name="HUD" type="CanvasLayer" parent="."]
layer = 5

[node name="MarginContainer" type="MarginContainer" parent="HUD"]
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
grow_horizontal = 2
grow_vertical = 2
theme_override_constants/margin_left = 10
theme_override_constants/margin_top = 5
theme_override_constants/margin_right = 10
theme_override_constants/margin_bottom = 5

[node name="SlidingTextBox" type="MarginContainer" parent="HUD/MarginContainer"]
custom_minimum_size = Vector2(0, 60)
layout_mode = 2
size_flags_vertical = 0
theme = ExtResource("14_0lu6w")
script = ExtResource("14_jrd6n")
horizontal_text_alignment = 2
vertical_text_alignment = 2
metadata/_custom_type_script = "uid://de5ltvkys2rps"

[node name="HBoxContainer" type="HBoxContainer" parent="HUD/MarginContainer"]
layout_mode = 2

[node name="FloorCounterHUD" type="Label" parent="HUD/MarginContainer/HBoxContainer" node_paths=PackedStringArray("staircase_level_manager")]
layout_mode = 2
size_flags_horizontal = 2
size_flags_vertical = 8
theme = ExtResource("14_0lu6w")
text = "Floor: 1/7"
script = ExtResource("15_i6gbm")
staircase_level_manager = NodePath("../../../../staircase_level_manager")

[node name="DesperationHUD" parent="HUD/MarginContainer/HBoxContainer" node_paths=PackedStringArray("player") instance=ExtResource("15_0lu6w")]
z_index = 2000
layout_mode = 2
size_flags_horizontal = 8
size_flags_vertical = 8
player = NodePath("../../../../player")

[node name="HungerHUD" parent="HUD/MarginContainer/HBoxContainer" node_paths=PackedStringArray("player") instance=ExtResource("14_ve786")]
layout_mode = 2
size_flags_horizontal = 8
size_flags_vertical = 8
player = NodePath("../../../../player")

[node name="SubViewport" type="SubViewport" parent="."]
transparent_bg = true
handle_input_locally = false
canvas_item_default_texture_filter = 0
size = Vector2i(320, 180)
render_target_update_mode = 4
script = ExtResource("17_ux4dc")

[node name="xray_player" parent="SubViewport" node_paths=PackedStringArray("follow_player") instance=ExtResource("17_i6gbm")]
position = Vector2(107, 30)
follow_player = NodePath("../../player")
